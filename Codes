package org.example.config;

import javax.annotation.PostConstruct;
import java.lang.reflect.Field;
import java.net.InetAddress;
import java.util.Map;

public class CustomDnsFix {

    private static final String TARGET_HOST = "api-int.staging.echonet";
    private static final String TARGET_IP = "10.117.159.50"; // ← Use your nslookup IP

    @PostConstruct
    public void patchDns() {
        try {
            System.out.println("Forcing DNS resolution for: " + TARGET_HOST + " => " + TARGET_IP);

            InetAddress ip = InetAddress.getByAddress(TARGET_HOST, InetAddress.getByName(TARGET_IP).getAddress());

            Field addressCacheField = InetAddress.class.getDeclaredField("addressCache");
            addressCacheField.setAccessible(true);
            Object addressCache = addressCacheField.get(null);

            Class<?> cacheClass = addressCache.getClass();
            Field cacheMapField = cacheClass.getDeclaredField("cache");
            cacheMapField.setAccessible(true);
            @SuppressWarnings("unchecked")
            Map<String, Object> cacheMap = (Map<String, Object>) cacheMapField.get(addressCache);

            cacheMap.put(TARGET_HOST, ip);
            System.out.println("✅ DNS override applied successfully");

        } catch (Exception e) {
            System.err.println("❌ DNS override failed: " + e.getMessage());
            e.printStackTrace(); // ← This will show the real reason
        }
    }
}
