@Service
public class AuthService {

    private final WebClient webClient;

    @Value("${auth.url}")
    private String authUrl;

    @Value("${auth.client-id}")
    private String clientId;

    @Value("${auth.client-secret}")
    private String clientSecret;

    public AuthService(WebClient.Builder builder) {
        this.webClient = builder.build();
    }

    public String fetchAuthToken() {
        try {
            Map<String, String> request = Map.of(
                "clientId", clientId,
                "clientSecret", clientSecret
            );

            Map<String, String> response = webClient.post()
                .uri(authUrl)
                .header("Content-Type", "application/json")
                .bodyValue(request)
                .retrieve()
                .bodyToMono(new ParameterizedTypeReference<Map<String, String>>() {})
                .block();

            return response.get("accessToken");
        } catch (Exception e) {
            throw new RuntimeException("Failed to fetch auth token", e);
        }
    }
}
